class CasinoFinder{constructor(s,e){this.container=s,this.steps=e.steps,this.casinos=e.casinos,this.config=e,this.currentStep=0,this.answers={},this.init()}init(){this.announcer=document.createElement("div"),this.announcer.className="cf-sr-only",this.announcer.setAttribute("aria-live","assertive"),this.announcer.setAttribute("aria-atomic","true"),this.container.parentNode.insertBefore(this.announcer,this.container.nextSibling),this.container.addEventListener("click",s=>this.handleClick(s)),this.container.addEventListener("keydown",s=>this.handleKeydown(s)),this.render()}esc(s){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return String(s).replace(/[&<>"']/g,s=>e[s])}announce(s){this.announcer.textContent="",setTimeout(()=>{this.announcer.textContent=s},50)}handleKeydown(s){if("Enter"!==s.key&&" "!==s.key)return;const e=s.target.closest(".cf-option");e&&(s.preventDefault(),e.click())}handleClick(s){const e=s.target.closest(".cf-option");if(e)return void this.handleOptionClick(e.dataset.step,e.dataset.value);if(s.target.closest(".cf-back-btn"))return void this.goToPreviousStep();if(s.target.closest(".cf-reset-btn"))return void this.reset();const n=s.target.closest(".cf-card__promo-copy");n&&this.handleCopyCode(n.dataset.code,n)}handleCopyCode(s,e){navigator.clipboard.writeText(s).then(()=>{const s=e.innerHTML;e.innerHTML="&#10003;",e.classList.add("cf-card__promo-copy--copied"),this.announce("Promo code copied to clipboard"),setTimeout(()=>{e.innerHTML=s,e.classList.remove("cf-card__promo-copy--copied")},2e3)})}handleOptionClick(s,e){this.answers[s]=e,this.currentStep<this.steps.length-1?(this.currentStep++,this.render()):this.renderLoadingScreen()}goToPreviousStep(){this.currentStep>0&&(this.currentStep--,this.render())}reset(){this.currentStep=0,this.answers={},this.render()}render(){this.container.innerHTML=this.renderProgressBar()+this.renderStep(this.currentStep),this.setFocus()}setFocus(){const s=this.container.querySelector(".cf-option");s&&s.focus()}scrollToTop(){this.container.scrollIntoView({behavior:"smooth",block:"start"})}renderStep(s){const e=this.steps[s],n=this.answers[e.id]||null,t=e.options.map(s=>`\n        <button class="cf-option${s.value===n?" cf-option--selected":""}"\n                type="button"\n                data-step="${this.esc(e.id)}"\n                data-value="${this.esc(s.value)}"\n                aria-pressed="${s.value===n}">\n          <span class="cf-option__icon">${this.esc(s.icon)}</span>\n          <span class="cf-option__label">${this.esc(s.label)}</span>\n        </button>\n      `).join(""),a=s>0?'<div class="cf-step__nav">\n          <button class="cf-back-btn" type="button">&larr; Go Back</button>\n          <button class="cf-reset-btn" type="button">Start Over</button>\n        </div>':"";return`\n      <div class="cf-step">\n        <h2 class="cf-step__question">${this.esc(e.question)}</h2>\n        <div class="cf-step__options">\n          ${t}\n        </div>\n        ${a}\n      </div>\n    `}renderLoadingScreen(){const s=this.config.loading_messages;this.container.innerHTML=`\n      ${this.renderProgressBar(!0)}\n      <div class="cf-loading">\n        <div class="cf-loading__spinner"></div>\n        <p class="cf-loading__message" aria-live="polite"></p>\n      </div>\n    `;const e=this.container.querySelector(".cf-loading__message"),n=window.matchMedia("(prefers-reduced-motion: reduce)").matches?200:800;s.forEach((s,t)=>{setTimeout(()=>{e.textContent=s},t*n)}),setTimeout(()=>{const s=this.calculateResults();this.renderResults(s)},s.length*n)}renderResults(s){if(!s.length)return this.container.innerHTML=`\n        ${this.renderProgressBar(!0)}\n        <div class="cf-no-results">\n          <p class="cf-no-results__message">${this.esc(this.config.no_results_message)}</p>\n          <button class="cf-reset-btn" type="button">Start Over</button>\n        </div>\n      `,void this.scrollToTop();const e=this.config.results_intro.replace("{total}",this.casinos.length),n=this.config.plugin_url,t=s.map((s,e)=>`\n      <div class="cf-result-card" data-rank="${e+1}">\n        <span class="cf-card__rank">${e+1}</span>\n\n        <div class="cf-card__badge">\n          <span class="cf-card__badge-star">&#9733;</span>\n          <span class="cf-card__badge-score">${this.esc(s.rating)}</span>\n          <span class="cf-card__badge-max">/ 5</span>\n        </div>\n\n        <div class="cf-card__logo">\n          <img src="${this.esc(n)}assets/images/${this.esc(s.logo)}"\n               alt="${this.esc(s.name)}"\n               loading="lazy"\n               width="200"\n               height="60">\n        </div>\n\n        <div class="cf-card__features">\n          <div class="cf-card__feature">\n            <span class="cf-card__feature-label">Slot Games</span>\n            <span class="cf-card__feature-value">${this.esc(s.slot_games)}</span>\n          </div>\n          <div class="cf-card__feature cf-card__feature--bordered">\n            <span class="cf-card__feature-label">Packages</span>\n            <span class="cf-card__feature-value">${s.has_packages?"YES":"NO"}</span>\n          </div>\n          <div class="cf-card__feature">\n            <span class="cf-card__feature-label">VIP</span>\n            <span class="cf-card__feature-value">${s.has_vip?"YES":"NO"}</span>\n          </div>\n        </div>\n\n        <hr class="cf-card__divider">\n\n        <a href="${this.esc(s.review_url)}" class="cf-card__review-link">${this.esc(s.name)} review</a>\n\n        <p class="cf-card__bonus-text">${this.esc(s.bonus_text)}</p>\n\n        <div class="cf-card__promo">\n          <span class="cf-card__promo-code">${this.esc(s.promo_code)}</span>\n          <button class="cf-card__promo-copy"\n                  type="button"\n                  data-code="${this.esc(s.promo_code)}"\n                  aria-label="Copy promo code ${this.esc(s.promo_code)}">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>\n              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>\n            </svg>\n          </button>\n        </div>\n\n        <a href="${this.esc(s.affiliate_url)}"\n           class="cf-card__cta"\n           target="_blank"\n           rel="noopener noreferrer">\n          Play at ${this.esc(s.name)}\n        </a>\n      </div>\n    `).join("");this.container.innerHTML=`\n      ${this.renderProgressBar(!0)}\n      <div class="cf-results">\n        <p class="cf-results__intro">${this.esc(e)}</p>\n        <div class="cf-results__grid">\n          ${t}\n        </div>\n        <button class="cf-reset-btn" type="button">Start Over</button>\n      </div>\n    `,this.scrollToTop()}calculateResults(){const s=40,e=25,n=20,t=15,a=["instant","1-2-days","up-to-1-week"],r=this.casinos.map(r=>{let c=0;const i=this.answers["casino-type"];i&&r.types.includes(i)&&(c+=s);const o=this.answers.game;o&&r.games.includes(o)&&(c+=e);const l=this.answers.banking;l&&r.banking.includes(l)&&(c+=n);const d=this.answers.payout;if(d){const s=a.indexOf(d),e=a.indexOf(r.payout_speed)-s;e<=0?c+=t:1===e&&(c+=t/2)}return{casino:r,score:c}});return r.sort((s,e)=>e.score-s.score||e.casino.rating-s.casino.rating),r.filter(s=>s.score>0).slice(0,3).map(s=>s.casino)}renderProgressBar(s=!1){const e=this.steps.length+1,n=this.steps.map((e,n)=>{let t="upcoming";return s||n<this.currentStep?t="completed":n===this.currentStep&&(t="active"),`\n        <div class="cf-progress__step cf-progress__step--${t}">\n          <div class="cf-progress__dot">\n            ${"completed"===t?'<span class="cf-progress__check">&#10003;</span>':""}\n          </div>\n          <span class="cf-progress__label">${this.esc(e.title)}</span>\n        </div>\n      `}).join(""),t=`\n      <div class="cf-progress__step cf-progress__step--${s?"active":"upcoming"}">\n        <div class="cf-progress__dot"></div>\n        <span class="cf-progress__label">Best Match</span>\n      </div>\n    `;return`\n      <div class="cf-progress"\n           role="progressbar"\n           aria-valuenow="${s?e:this.currentStep+1}"\n           aria-valuemin="1"\n           aria-valuemax="${e}"\n           style="--progress: ${(s?e-1:this.currentStep)/(e-1)*100}">\n        ${n}\n        ${t}\n      </div>\n    `}}document.addEventListener("DOMContentLoaded",()=>{const s=document.querySelectorAll(".casino-finder");s.length&&window.casinoFinderConfig&&s.forEach(s=>new CasinoFinder(s,window.casinoFinderConfig))});