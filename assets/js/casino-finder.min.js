class CasinoFinder{constructor(n,s){this.container=n,this.steps=s.steps,this.casinos=s.casinos,this.config=s,this.currentStep=0,this.answers={},this.init()}init(){this.announcer=document.createElement("div"),this.announcer.className="cf-sr-only",this.announcer.setAttribute("aria-live","assertive"),this.announcer.setAttribute("aria-atomic","true"),this.container.parentNode.insertBefore(this.announcer,this.container.nextSibling),this.container.addEventListener("click",n=>this.handleClick(n)),this.container.addEventListener("keydown",n=>this.handleKeydown(n)),this.render()}announce(n){this.announcer.textContent="",setTimeout(()=>{this.announcer.textContent=n},50)}handleKeydown(n){if("Enter"!==n.key&&" "!==n.key)return;const s=n.target.closest(".cf-option");s&&(n.preventDefault(),s.click())}handleClick(n){const s=n.target.closest(".cf-option");if(s)return void this.handleOptionClick(s.dataset.step,s.dataset.value);if(n.target.closest(".cf-back-btn"))return void this.goToPreviousStep();if(n.target.closest(".cf-reset-btn"))return void this.reset();const e=n.target.closest(".cf-card__promo-copy");e&&this.handleCopyCode(e.dataset.code,e)}handleCopyCode(n,s){navigator.clipboard.writeText(n).then(()=>{const n=s.innerHTML;s.innerHTML="&#10003;",s.classList.add("cf-card__promo-copy--copied"),this.announce("Promo code copied to clipboard"),setTimeout(()=>{s.innerHTML=n,s.classList.remove("cf-card__promo-copy--copied")},2e3)})}handleOptionClick(n,s){this.answers[n]=s,this.currentStep<this.steps.length-1?(this.currentStep++,this.render()):this.renderLoadingScreen()}goToPreviousStep(){this.currentStep>0&&(this.currentStep--,this.render())}reset(){this.currentStep=0,this.answers={},this.render()}render(){this.container.innerHTML=this.renderProgressBar()+this.renderStep(this.currentStep),this.setFocus()}setFocus(){const n=this.container.querySelector(".cf-option");n&&n.focus()}scrollToTop(){this.container.scrollIntoView({behavior:"smooth",block:"start"})}renderStep(n){const s=this.steps[n],e=this.answers[s.id]||null,t=s.options.map(n=>`\n        <button class="cf-option${n.value===e?" cf-option--selected":""}"\n                type="button"\n                data-step="${s.id}"\n                data-value="${n.value}"\n                aria-pressed="${n.value===e}">\n          <span class="cf-option__icon">${n.icon}</span>\n          <span class="cf-option__label">${n.label}</span>\n        </button>\n      `).join(""),a=n>0?'<div class="cf-step__nav">\n          <button class="cf-back-btn" type="button">&larr; Go Back</button>\n          <button class="cf-reset-btn" type="button">Start Over</button>\n        </div>':"";return`\n      <div class="cf-step">\n        <h2 class="cf-step__question">${s.question}</h2>\n        <div class="cf-step__options">\n          ${t}\n        </div>\n        ${a}\n      </div>\n    `}renderLoadingScreen(){const n=this.config.loading_messages;this.container.innerHTML=`\n      ${this.renderProgressBar(!0)}\n      <div class="cf-loading">\n        <div class="cf-loading__spinner"></div>\n        <p class="cf-loading__message" aria-live="polite"></p>\n      </div>\n    `;const s=this.container.querySelector(".cf-loading__message"),e=window.matchMedia("(prefers-reduced-motion: reduce)").matches?200:800;n.forEach((n,t)=>{setTimeout(()=>{s.textContent=n},t*e)}),setTimeout(()=>{const n=this.calculateResults();this.renderResults(n)},n.length*e)}renderResults(n){if(!n.length)return this.container.innerHTML=`\n        ${this.renderProgressBar(!0)}\n        <div class="cf-no-results">\n          <p class="cf-no-results__message">${this.config.no_results_message}</p>\n          <button class="cf-reset-btn" type="button">Start Over</button>\n        </div>\n      `,void this.scrollToTop();const s=this.config.results_intro.replace("{total}",this.casinos.length),e=this.config.plugin_url,t=n.map((n,s)=>`\n      <div class="cf-result-card" data-rank="${s+1}">\n        <span class="cf-card__rank">${s+1}</span>\n\n        <div class="cf-card__badge">\n          <span class="cf-card__badge-star">&#9733;</span>\n          <span class="cf-card__badge-score">${n.rating}</span>\n          <span class="cf-card__badge-max">/ 5</span>\n        </div>\n\n        <div class="cf-card__logo">\n          <img src="${e}assets/images/${n.logo}"\n               alt="${n.name}"\n               loading="lazy"\n               width="200"\n               height="60">\n        </div>\n\n        <div class="cf-card__features">\n          <div class="cf-card__feature">\n            <span class="cf-card__feature-label">Slot Games</span>\n            <span class="cf-card__feature-value">${n.slot_games}</span>\n          </div>\n          <div class="cf-card__feature cf-card__feature--bordered">\n            <span class="cf-card__feature-label">Packages</span>\n            <span class="cf-card__feature-value">${n.has_packages?"YES":"NO"}</span>\n          </div>\n          <div class="cf-card__feature">\n            <span class="cf-card__feature-label">VIP</span>\n            <span class="cf-card__feature-value">${n.has_vip?"YES":"NO"}</span>\n          </div>\n        </div>\n\n        <hr class="cf-card__divider">\n\n        <a href="${n.review_url}" class="cf-card__review-link">${n.name} review</a>\n\n        <p class="cf-card__bonus-text">${n.bonus_text}</p>\n\n        <div class="cf-card__promo">\n          <span class="cf-card__promo-code">${n.promo_code}</span>\n          <button class="cf-card__promo-copy"\n                  type="button"\n                  data-code="${n.promo_code}"\n                  aria-label="Copy promo code ${n.promo_code}">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>\n              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>\n            </svg>\n          </button>\n        </div>\n\n        <a href="${n.affiliate_url}"\n           class="cf-card__cta"\n           target="_blank"\n           rel="noopener noreferrer">\n          Play at ${n.name}\n        </a>\n      </div>\n    `).join("");this.container.innerHTML=`\n      ${this.renderProgressBar(!0)}\n      <div class="cf-results">\n        <p class="cf-results__intro">${s}</p>\n        <div class="cf-results__grid">\n          ${t}\n        </div>\n        <button class="cf-reset-btn" type="button">Start Over</button>\n      </div>\n    `,this.scrollToTop()}calculateResults(){const n=40,s=25,e=20,t=15,a=["instant","1-2-days","up-to-1-week"],r=this.casinos.map(r=>{let c=0;const i=this.answers["casino-type"];i&&r.types.includes(i)&&(c+=n);const o=this.answers.game;o&&r.games.includes(o)&&(c+=s);const d=this.answers.banking;d&&r.banking.includes(d)&&(c+=e);const l=this.answers.payout;if(l){const n=a.indexOf(l),s=a.indexOf(r.payout_speed)-n;s<=0?c+=t:1===s&&(c+=t/2)}return{casino:r,score:c}});return r.sort((n,s)=>s.score-n.score||s.casino.rating-n.casino.rating),r.filter(n=>n.score>0).slice(0,3).map(n=>n.casino)}renderProgressBar(n=!1){const s=this.steps.length+1,e=this.steps.map((s,e)=>{let t="upcoming";return n||e<this.currentStep?t="completed":e===this.currentStep&&(t="active"),`\n        <div class="cf-progress__step cf-progress__step--${t}">\n          <div class="cf-progress__dot">\n            ${"completed"===t?'<span class="cf-progress__check">&#10003;</span>':""}\n          </div>\n          <span class="cf-progress__label">${s.title}</span>\n        </div>\n      `}).join(""),t=`\n      <div class="cf-progress__step cf-progress__step--${n?"active":"upcoming"}">\n        <div class="cf-progress__dot"></div>\n        <span class="cf-progress__label">Best Match</span>\n      </div>\n    `;return`\n      <div class="cf-progress"\n           role="progressbar"\n           aria-valuenow="${n?s:this.currentStep+1}"\n           aria-valuemin="1"\n           aria-valuemax="${s}"\n           style="--progress: ${(n?s-1:this.currentStep)/(s-1)*100}">\n        ${e}\n        ${t}\n      </div>\n    `}}document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelectorAll(".casino-finder");n.length&&window.casinoFinderConfig&&n.forEach(n=>new CasinoFinder(n,window.casinoFinderConfig))});